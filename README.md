# ✅ 血圧推定DLL 要件定義書（確定版）

## 🔷 1. 概要

本DLLは、PCに保存された30秒間の動画データを入力とし、非侵襲的に最高血圧および最低血圧を推定します。呼び出し元から解析リクエストを受け取った後、非同期で処理を実行し、コールバック関数を通じて推定結果と検証用データを返却します。


## 🔷 2. DLL機能一覧

| 機能名 | 説明 |
| --- | --- |
| 血圧解析開始（リクエスト） | 身体情報および動画を元に解析を実行 |
| 血圧解析コールバック | 推定結果（血圧・PPGローデータ・エラー）を返却 |
| 血圧解析中断 | 指定リクエストの処理を中断 |
| 処理状況取得 | 指定リクエストのステータスを返却 |
| バージョン情報取得 | DLL内部のバージョンを返却 |


## 🔷 3. 各機能詳細

### 3.1 血圧解析リクエスト

### ■ パラメータ（入力）

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | `requestId` | 文字列 | ○ | `${yyyyMMddHHmmssfff}_${顧客コード}_${乗務員コード}`例：20250707083524932_9000000001_0000012345 |
| 2 | `height` | 数値 | ○ | 身長（cm）、整数、例：170 |
| 3 | `weight` | 数値 | ○ | 体重（kg）、整数、例：60 |
| 4 | `sex` | 数値 | ○ | 1：男性、2：女性 |
| 5 | `measurementMoviePath` | 文字列 | ○ | WebM動画ファイルのPC上のフルパス（※1） |
| 6 | `callback` | 関数 | 任意 | IF011_血圧解析コールバックに準拠 |

### ■ レスポンス

| パラメータ名 | 型 | 備考 |
| --- | --- | --- |
| `errorCode` | 文字列 | エラーなしの場合：`null`エラー発生時：DLL定義のエラーコードを返却（下記一覧を参照） |

### ※1 動画仕様

| 項目 | 内容 |
| --- | --- |
| 撮影時間 | 30秒 |
| フレームレート | 30FPS |
| 解像度 | 1280x720（100万画素） |
| コンテナ | WebM |
| コーデック | VP8 |
| 拡張子 | `.webm` |
| ビットレート | 約2.5Mbps |

---

### 3.2 血圧解析コールバック（IF011）

### ■ コールバックパラメータ（引数）

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | `requestId` | 文字列 | ○ | リクエスト時のIDと同一 |
| 2 | `maxBloodPressure` | 数値 | ○ | 最高血圧、最大値999（整数） |
| 3 | `minBloodPressure` | 数値 | ○ | 最低血圧、最大値999（整数） |
| 4 | `measureRowData` | 文字列 | ○ | PPGローデータ（CSV形式、20KB程度）※保存されるCSVファイルは動画と拡張子以外が一致 |
| 5 | `errors` | 配列 | ○ | エラーがなければ空配列要素：`code`, `message`, `isRetriable` |

---

### 3.3 血圧解析中断リクエスト

### ■ 入力

| パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- |
| `requestId` | 文字列 | ○ | 対象となるリクエストID |

### ■ 出力

| パラメータ名 | 型 | 内容 |
| --- | --- | --- |
| `isSuccess` | 真偽値 | `true`：中断成功、`false`：失敗 |

---

### 3.4 処理状況取得

### ■ 入力

| パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- |
| `requestId` | 文字列 | ○ | 対象となるリクエストID |

### ■ 出力

| パラメータ名 | 型 | 内容 |
| --- | --- | --- |
| `status` | 文字列 | `"none"`（未受付）`"processing"`（処理中）※処理完了はコールバックで通知される前提 |

---

### 3.5 バージョン情報取得

### ■ 入力

なし

### ■ 出力

| パラメータ名 | 型 | 内容 |
| --- | --- | --- |
| `versionInfo` | 文字列 | DLL側のバージョン文字列（例：`v1.0.0`） |

---

## 🔷 4. エラーコード一覧

| コード | 内容 | 備考 |
| --- | --- | --- |
| 1001 | DLLが初期化されていない | Init処理未実行など |
| 1002 | デバイス接続失敗 | カメラ・センサ未接続 |
| 1003 | キャリブレーション未完了 | 測定前にキャリブレーションが必要 |
| 1004 | 入力パラメータ不正 | NULLポインタ・異常値 |
| 1005 | 測定中リクエスト受付不可 | 排他制御などの理由 |
| 1006 | DLL内部処理エラー | 予期せぬ例外など |
| ※1001～1003は現用途では原則発生しない想定 |  |  |
