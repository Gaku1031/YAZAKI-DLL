## 🔧 血圧推定DLL 要件定義

### ✅ 1. 概要

PC内の保存動画（30秒・WebM形式）から血圧を推定するDLL。呼び出し元アプリケーションから各種パラメータと動画パスを受け取り、非同期で解析を実行し、コールバックで結果（血圧・PPGローデータ・エラー）を返す。

---

### ✅ 2. 主な機能一覧

| 機能 | 概要 |
| --- | --- |
| 血圧解析リクエスト | 動画とユーザー情報をもとに血圧推定処理を開始 |
| コールバック処理 | 血圧推定結果を返却（最高/最低血圧、PPGデータ、エラー情報） |
| 中断処理 | 指定リクエストIDの解析処理を中断 |
| 処理状況取得 | 処理状態（未受付・処理中）を確認 |
| バージョン情報取得 | DLLのバージョン文字列を取得 |

---

### ✅ 3. 入力仕様

### ■ 血圧解析リクエスト

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | requestId | 文字列 | ○ | `${yyyyMMddHHmmssfff}_${乗務員CD}` |
| 2 | height | 数値 | ○ | cm単位、整数のみ |
| 3 | weight | 数値 | ○ | kg単位、整数のみ |
| 4 | sex | 数値 | ○ | `1=男性`, `2=女性` |
| 5 | measurementMoviePath | 文字列 | ○ | WebM形式の動画フルパス |
| 6 | callback | 関数 | 任意 | コールバック関数（IF004に準拠） |

### ■ 動画仕様（※ファイルは事前保存済み）

- 長さ：30秒
- フレームレート：30FPS
- 解像度：1280x720（100万画素）
- 形式：WebM（VP8エンコード）
- ビットレート：2.5Mbps

---

### ✅ 4. コールバック仕様（IF004）

| No | パラメータ名 | 型 | 備考 |
| --- | --- | --- | --- |
| 1 | requestId | 文字列 | リクエスト時と同一ID |
| 2 | maxBloodPressure | 数値 | 整数（最大999） |
| 3 | minBloodPressure | 数値 | 整数（最大999） |
| 4 | measureRowData | 文字列 | PPGローデータ（CSV、20KB程度） |
| 5 | errors | 配列 | エラーがあれば複数件返る（なければ空）各要素は以下：　- code（文字列）　- message（文字列）　- isRetriable（boolean） |

---

### ✅ 5. その他の機能仕様

### ■ 処理中断リクエスト

- 引数：`requestId`（必須）
- 戻り値：`isSuccess（boolean）`

### ■ 処理状況取得

- 引数：`requestId`（必須）
- 戻り値：`status（文字列）`
    - `"none"`（未受付）
    - `"processing"`（処理中）
        
        ※処理完了はコールバックで通知されるため含まない
        

### ■ バージョン情報取得

- 引数：なし
- 戻り値：`versionInfo（文字列）`

---

### ✅ 6. エラーコード定義（DLL内処理）

| コード | 内容 | 備考 |
| --- | --- | --- |
| 1001 | DLL未初期化 | Init未実行など |
| 1002 | デバイス接続失敗 | カメラ・センサ未接続（今回は想定外） |
| 1003 | キャリブレーション未完了 | 実施前に測定要求（今回は想定外） |
| 1004 | 入力パラメータ不正 | NULLや異常値 |
| 1005 | 測定中リクエスト不可 | 排他制御タイミング |
| 1006 | DLL内部処理エラー | 想定外の例外発生 |

---

### ✅ 7. 実装制約

- DLL形式：**32ビット DLL**
- CSVローデータ出力形式：文字列（20KB程度）
