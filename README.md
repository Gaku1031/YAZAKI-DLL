## ✅ 血圧推定DLL 要件定義（最新仕様）

---

### 📝 1. 概要

保存された30秒の動画から非侵襲的に血圧を推定するDLL。呼び出し元アプリからのリクエストを受け、非同期で血圧推定を実行し、結果はコールバックで返す。検証用にPPGローデータ（CSV形式）もファイル保存される。

---

### ✅ 2. 主な機能一覧

| 機能 | 概要 |
| --- | --- |
| 血圧解析リクエスト | 動画と個人情報を元に血圧推定処理を開始 |
| 血圧解析コールバック | 結果（SBP/DBP）と検証用PPGデータ、エラー情報を返却 |
| 血圧解析中断 | 指定のリクエストIDで実行中の処理を中断 |
| 処理状況取得 | 指定リクエストのステータス取得（none / processing） |
| バージョン情報取得 | DLLのバージョン情報を取得 |

---

### ✅ 3. 血圧解析リクエスト

### ■ リクエストパラメータ

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | requestId | 文字列 | ○ | `${yyyyMMddHHmmssfff}_${顧客コード}_${乗務員コード}` |
| 2 | height | 数値 | ○ | cm単位、整数、例: `170` |
| 3 | weight | 数値 | ○ | kg単位、整数、例: `60` |
| 4 | sex | 数値 | ○ | `1: 男性`, `2: 女性` |
| 5 | measurementMoviePath | 文字列 | ○ | WebM形式の動画ファイルフルパス |
| 6 | callback | 関数 | 任意 | コールバック関数（IF004仕様に準拠） |

### ■ 動画要件

| 項目 | 内容 |
| --- | --- |
| 撮影秒数 | 30秒 |
| フレームレート | 30FPS |
| 解像度 | 1280x720（100万画素） |
| コンテナ形式 | WebM |
| コーデック | VP8 |
| 拡張子 | `.webm` |
| ビットレート | 約2.5Mbps |

---

### ✅ 4. 血圧解析コールバック（IF004）

### ■ コールバックパラメータ

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | requestId | 文字列 | ○ | リクエストIDと同一 |
| 2 | maxBloodPressure | 数値 | ○ | 最大値: 999（3桁） |
| 3 | minBloodPressure | 数値 | ○ | 最大値: 999（3桁） |
| 4 | measureRowData | 文字列 | ○ | PPGローデータ、CSV形式（20KB程度）、ファイル名は動画ファイルと同一ID＋`.csv`、拡張子以外が一致 |
| 5 | errors | 配列 | ○ | エラーなし時は空配列。以下の要素を含む:・code（文字列）・message（文字列）・isRetriable（真偽値） |

---

### ✅ 5. 血圧解析中断リクエスト

### ■ リクエストパラメータ

| No | パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- | --- |
| 1 | requestId | 文字列 | ○ | リクエストID（形式同上） |

### ■ レスポンス

| パラメータ名 | 型 | 必須 | 内容 |
| --- | --- | --- | --- |
| isSuccess | 真偽値 | ○ | `true`: 成功 / `false`: 失敗 |

---

### ✅ 6. 血圧解析処理状況取得

### ■ リクエストパラメータ

| パラメータ名 | 型 | 必須 | 備考 |
| --- | --- | --- | --- |
| requestId | 文字列 | ○ | リクエストID |

### ■ レスポンス

| パラメータ名 | 型 | 必須 | 内容 |
| --- | --- | --- | --- |
| status | 文字列 | ○ | `none`: 未受付 / `processing`: 処理中※完了時はコールバックが返される前提のため「完了」は含まない |

---

### ✅ 7. DLLバージョン情報取得

### ■ リクエストパラメータ

なし

### ■ レスポンス

| パラメータ名 | 型 | 必須 | 内容 |
| --- | --- | --- | --- |
| versionInfo | 文字列 | ○ | DLL内部で定義されたバージョン文字列 |

---

### ✅ 8. エラーコード一覧（DLL内部）

| エラーコード | 内容 | 備考 |
| --- | --- | --- |
| 1001 | DLLが初期化されていない | Init未実行など |
| 1002 | デバイス接続失敗 | カメラ・センサ未接続（今回の用途では発生見込みなし） |
| 1003 | キャリブレーション未完了 | 測定前の実施必要（今回の用途では発生見込みなし） |
| 1004 | 入力パラメータ不正 | NULLポインタ、不正な値 |
| 1005 | 測定中リクエスト受付不可 | 排他制御などにより測定拒否 |
| 1006 | DLL内部処理エラー | 想定外の例外発生時など |
